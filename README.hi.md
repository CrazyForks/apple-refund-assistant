## apple-refund-assistant
![GitHub Actions Workflow Status](https://img.shields.io/github/actions/workflow/status/seth-shi/apple-refund-assistant/laravel.yml)
[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=seth-shi_apple-refund-assistant&metric=coverage)](https://sonarcloud.io/summary/new_code?id=seth-shi_apple-refund-assistant)
[![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=seth-shi_apple-refund-assistant&metric=sqale_rating)](https://sonarcloud.io/summary/new_code?id=seth-shi_apple-refund-assistant)
![CodeRabbit Pull Request Reviews](https://img.shields.io/coderabbit/prs/github/seth-shi/apple-refund-assistant?utm_source=oss&utm_medium=github&utm_campaign=seth-shi%2Fapple-refund-assistant&labelColor=171717&color=FF570A&link=https%3A%2F%2Fcoderabbit.ai&label=CodeRabbit+Reviews)

[English](./README.md) | [чоАф╜Уф╕нцЦЗ](./README.zh.md) | [Espa├▒ol](./README.es.md) | рд╣рд┐рдиреНрджреА | [╪з┘Д╪╣╪▒╪и┘К╪й](./README.ar.md) | [Portugu├кs](./README.pt.md) | [╨а╤Г╤Б╤Б╨║╨╕╨╣](./README.ru.md) | [цЧецЬмшкЮ](./README.ja.md) | [Fran├зais](./README.fr.md)

рдпрд╣ рд╕реЗрд╡рд╛ Laravel / Filament рдорд▓реНрдЯреА-рдЯреЗрдиреЗрдВрдЯ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдкрд░ рдмрдирд╛рдИ рдЧрдИ рд╣реИ,
Apple рдХреЗ CONSUMPTION_REQUEST рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдХреЛ рддреБрд░рдВрдд рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдХреЗ рдФрд░ рдЦрдкрдд рдбреЗрдЯрд╛ рдХреЛ рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд░реВрдк рд╕реЗ рд╡рд╛рдкрд╕ рдХрд░рдХреЗ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рдзреЛрдЦрд╛рдзрдбрд╝реА рд░рд┐рдлрдВрдб рдХреЛ рд░реЛрдХрдиреЗ рдореЗрдВ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдорджрдж рдХрд░рддреА рд╣реИред

- **рдорд▓реНрдЯреА-рдЯреЗрдиреЗрдВрдЯ рд╕рдкреЛрд░реНрдЯ**
- **рдорд▓реНрдЯреА-рд▓реИрдВрдЧреНрд╡реЗрдЬ рд╕рдкреЛрд░реНрдЯ** (ф╕нцЦЗ / English / Espa├▒ol / рд╣рд┐рдиреНрджреА / ╪з┘Д╪╣╪▒╪и┘К╪й / Portugu├кs / ╨а╤Г╤Б╤Б╨║╨╕╨╣ / цЧецЬмшкЮ / Fran├зais)
- **рдорд▓реНрдЯреА-рдХрд░реЗрдВрд╕реА рд╕рдкреЛрд░реНрдЯ**
- **рдЬрд╝реАрд░реЛ рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реА File+SQLite** `рдпрд╛ Redis+MySQL рдореЗрдВ рдЕрдкрдЧреНрд░реЗрдб рдХрд░реЗрдВ`
- **100% рдЯреЗрд╕реНрдЯ рдХрд╡рд░реЗрдЬ**
- **рд╕реЗрд▓реНрдл-рдореИрдиреЗрдЬреНрдб рдРрдк рдХреАрдЬрд╝** рдкреНрд░рд╛рдЗрд╡реЗрдЯ рдХреАрдЬрд╝ рдХреЗрд╡рд▓ рдЖрдкрдХреЗ рдбреЗрдЯрд╛рдмреЗрд╕ `apps` рдЯреЗрдмрд▓ рдореЗрдВ рд╕реНрдЯреЛрд░ рд╣реЛрддреА рд╣реИрдВ (рд╕рд┐рдореЗрдЯреНрд░рд┐рдХ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд╕рд╛рде, рдЖрдкрдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рдЬреЗрдирд░реЗрдЯ рдХреА рдЧрдИ рдХреАрдЬрд╝)
- **12 рдХрдВрдЬрдореНрдкрд╢рди рдлреАрд▓реНрдбреНрд╕** - [рд╕рднреА рдЖрд╡рд╢реНрдпрдХ Apple рдлреАрд▓реНрдбреНрд╕ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ](#рдХрдВрдЬрдореНрдкрд╢рди-рдлреАрд▓реНрдб-рд╕реНрдЯреНрд░реИрдЯреЗрдЬреА)
- **рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдореИрд╕реЗрдЬ рдлреЙрд░рд╡рд░реНрдбрд┐рдВрдЧ** Apple рд╕рд░реНрд╡рд░ рд╡рд░реНрддрдорд╛рди рд╕реЗрд╡рд╛ рдХреЛ рднреЗрдЬрддрд╛ рд╣реИ, рд╡рд░реНрддрдорд╛рди рд╕реЗрд╡рд╛ рдЖрдкрдХреЗ рдкреНрд░реЛрдбрдХреНрд╢рди рд╕рд░реНрд╡рд░ рдХреЛ рдлреЙрд░рд╡рд░реНрдб рдХрд░рддреА рд╣реИ


## рдСрдирд▓рд╛рдЗрди рдбреЗрдореЛ

ЁЯМР **рдбреЗрдореЛ URL**: [https://apple-refund-assistant.shiguopeng.cn/](https://apple-refund-assistant.shiguopeng.cn/)

> тЪая╕П **рдиреЛрдЯ**: рд╕рд┐рд╕реНрдЯрдо рд╣рд░ 30 рдорд┐рдирдЯ рдореЗрдВ рд░реАрд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИред

 
## рд╕реНрдХреНрд░реАрдирд╢реЙрдЯреНрд╕
![рд╣реЛрдордкреЗрдЬ](assets/0.png)
![рд╣реЛрдордкреЗрдЬ](assets/1.png)
![рд╣реЛрдордкреЗрдЬ](assets/2.png)
![рд╣реЛрдордкреЗрдЬ](assets/3.png)
![рд╣реЛрдордкреЗрдЬ](assets/4.png)
![рд╣реЛрдордкреЗрдЬ](assets/5.png)


## рдХреНрд╡рд┐рдХ рд╕реНрдЯрд╛рд░реНрдЯ
### рдкрд╣рд▓реЗ рд╕реЗ рдмрд┐рд▓реНрдЯ рдЗрдореЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛
```bash
docker run -d \
  -p 8080:8080 \
  --name apple-refund-assistant \
  --restart=always \
  ghcr.io/seth-shi/apple-refund-assistant:latest
```


### рд▓реЛрдХрд▓ рдмрд┐рд▓реНрдб рдФрд░ рд░рди
```bash
git clone https://github.com/seth-shi/apple-refund-assistant
cd apple-refund-assistant
## рдЗрдореЗрдЬ рдмрд┐рд▓реНрдб рдХрд░реЗрдВ рдФрд░ рдбрд┐рдкреНрд▓реЙрдп рдХрд░реЗрдВ
./deploy.sh
```

### рдЕрдЧрд░ рдЖрдкрдХреЛ рдбреЗрдЯрд╛ рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛ рд╣реИ
```
touch database.sqlite
docker run -d \
  -p 8080:8080 \
  -v $(pwd)/database.sqlite:/var/www/html/database/database.sqlite \
  --name apple-refund-assistant \
  --restart=always \
  ghcr.io/seth-shi/apple-refund-assistant:latest
```

## рдХрдВрдЬрдореНрдкрд╢рди рдлреАрд▓реНрдб рд╕реНрдЯреНрд░реИрдЯреЗрдЬреА
* рдбреЙрдХреНрдпреВрдореЗрдВрдЯреЗрд╢рди: [https://developer.apple.com/documentation/appstoreserverapi/consumptionrequest](https://developer.apple.com/documentation/appstoreserverapi/consumptionrequest)
* рд╕реНрдЯреНрд░реИрдЯреЗрдЬреА рдХреЛрдб: [ConsumptionService.php](./app/Services/ConsumptionService.php) 
* `users` рдЯреЗрдмрд▓ рдлреАрд▓реНрдбреНрд╕ рдХреЛ рдЕрдиреНрдп рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ

| рдлреАрд▓реНрдб                       | рд╡рд┐рд╡рд░рдг                | рдбреЗрдЯрд╛ рд╕реЛрд░реНрд╕                          | рдЧрдгрдирд╛ рдирд┐рдпрдо                                                                                           |
|--------------------------|-------------------|--------------------------------|------------------------------------------------------------------------------------------------|
| accountTenure            | рдпреВрдЬрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди рджрд┐рди            | `users.register_at`            | рд╡рд░реНрддрдорд╛рди рд╕рдордп рдШрдЯрд╛ рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди рд╕рдордп                                                                                     |
| appAccountToken          | рдЕрдХрд╛рдЙрдВрдЯ рдЯреЛрдХрди          | `users.app_account_token`      | [рдХреНрд▓рд╛рдЗрдВрдЯ рджреНрд╡рд╛рд░рд╛ рдСрд░реНрдбрд░ рдмрдирд╛рддреЗ рд╕рдордп рдкрд╛рд╕ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ](https://developer.apple.com/documentation/StoreKit/Transaction/appAccountToken) |
| consumptionStatus        | рдХрдВрдЬрдореНрдкрд╢рди рд╕реНрдЯреЗрдЯрд╕              | `transactions.expiration_date` | рд╡рд░реНрддрдорд╛рди рд╕рдордп рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░реЗрдВ, рдпрджрд┐ рдПрдХреНрд╕рдкрд╛рдпрд░ рд╣реЛ рдЧрдпрд╛ рд╣реИ рддреЛ рдХрдВрдЬреНрдпреВрдореНрдб рд░рд┐рдЯрд░реНрди рдХрд░реЗрдВ                                                                              |
| customerConsented        | рдпреВрдЬрд░ рдбреЗрдЯрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рд╕рд╣рдорддрд┐          | рдХреЛрдИ рдирд╣реАрдВ                              | рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб `true`                                                                                       |
| deliveryStatus           | рдХреНрдпрд╛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдПрдХ рдлрдВрдХреНрд╢рдирд▓ рдЗрди-рдРрдк рдЦрд░реАрджрд╛рд░реА рдбрд┐рд▓реАрд╡рд░ рдХреА рдЧрдИред | рдХреЛрдИ рдирд╣реАрдВ                              | рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб `0`(рд╕рд╛рдорд╛рдиреНрдп рдбрд┐рд▓реАрд╡рд░реА)                                                                                    |
| lifetimeDollarsPurchased | рдХреБрд▓ рдЗрди-рдРрдк рдЦрд░реАрджрд╛рд░реА рд░рд╛рд╢рд┐             | `users.purchased_dollars`      | Apple рдЯреНрд░рд╛рдВрдЬреИрдХреНрд╢рди рдЗрд╡реЗрдВрдЯреНрд╕ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЗрд╕ рдлреАрд▓реНрдб рдХреЛ рдЬрдорд╛ рдХрд░реЗрдВ, рдЖрдк рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рднреА рдЬрдорд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ                                                                        |
| lifetimeDollarsRefunded  | рдХреБрд▓ рд░рд┐рдлрдВрдб рд░рд╛рд╢рд┐             | `users.refunded_dollars`       | Apple рд░рд┐рдлрдВрдб рдЗрд╡реЗрдВрдЯреНрд╕ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЗрд╕ рдлреАрд▓реНрдб рдХреЛ рдЬрдорд╛ рдХрд░реЗрдВ, рдЖрдк рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рднреА рдЬрдорд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ                                                                        |
| platform                 | рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо                | рдХреЛрдИ рдирд╣реАрдВ                              | рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб `1`(apple)                                                                                   |
| playTime                 | рдХрд╕реНрдЯрдорд░ рдРрдк рдЙрдкрдпреЛрдЧ рд╕рдордп рдореВрд▓реНрдп        | `users.play_seconds`           | рдЖрдкрдХреЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдЗрд╕ рдлреАрд▓реНрдб рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХрд╛ рд╕рдкреЛрд░реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЕрдиреНрдпрдерд╛ рдпрд╣ `0` рд╣реИ                                                                          |
| refundPreference         | рд░рд┐рдлрдВрдб рдЕрдиреБрд░реЛрдз рдХрд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдкрд░рд┐рдгрд╛рдо         | `transactions.expiration_date` | рд╡рд░реНрддрдорд╛рди рд╕рдордп рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░реЗрдВ, рдпрджрд┐ рдПрдХреНрд╕рдкрд╛рдпрд░ рд╣реЛ рдЧрдпрд╛ рд╣реИ рддреЛ рд░рд┐рдлрдВрдб рдХреЛ рд░рд┐рдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╢рд╛ рдХрд░реЗрдВ                                                                             |
| sampleContentProvided    | рдХреНрдпрд╛ рдЯреНрд░рд╛рдпрд▓ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ            | `apps.sample_content_provided` | рдРрдк рдмрдирд╛рддреЗ рд╕рдордп рдРрдк рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ                                                                                      |
| userStatus               | рдпреВрдЬрд░ рд╕реНрдЯреЗрдЯрд╕              | рдХреЛрдИ рдирд╣реАрдВ                              | рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб `1`(рд╕рд╛рдорд╛рдиреНрдп рдпреВрдЬрд░)                                                                                   |

## рднрд╡рд┐рд╖реНрдп рдХреА рдпреЛрдЬрдирд╛рдПрдВ
- рдХреНрдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрдиреНрдп рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ рдпрд╛ рд╕рд╣рдпреЛрдЧ рдореЗрдВ рд░реБрдЪрд┐ рд╣реИ? рдХреГрдкрдпрд╛ GitHub рдкрд░ рдПрдХ issue рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ - рд╣рдо рдЖрдкрдХреЗ рдлреАрдбрдмреИрдХ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ!

## рдЖрднрд╛рд░
* [Rates By Exchange Rate API](https://www.exchangerate-api.com)
* [https://github.com/argus-sight/refund-swatter-lite](https://github.com/argus-sight/refund-swatter-lite)