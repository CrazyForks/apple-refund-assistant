
## Apple рд░рд┐рдлрдВрдб рдЕрд╕рд┐рд╕реНрдЯреЗрдВрдЯ

[English](./README.md) | [чоАф╜Уф╕нцЦЗ](./README.zh.md) | [Espa├▒ol](./README.es.md) | рд╣рд┐рдиреНрджреА | [╪з┘Д╪╣╪▒╪и┘К╪й](./README.ar.md) | [Portugu├кs](./README.pt.md) | [╨а╤Г╤Б╤Б╨║╨╕╨╣](./README.ru.md) | [цЧецЬмшкЮ](./README.ja.md) | [Fran├зais](./README.fr.md)

Laravel рдЖрдзрд╛рд░рд┐рдд рдорд▓реНрдЯреА-рдЯреЗрдиреЗрдВрдЯ рдкреЗрдореЗрдВрдЯ рд░рд┐рдлрдВрдб рд░реЛрдХрдерд╛рдо рд╕реЗрд╡рд╛ред

![GitHub Actions Workflow Status](https://img.shields.io/github/actions/workflow/status/seth-shi/apple-refund-assistant/laravel.yml)
![Codecov](https://img.shields.io/codecov/c/github/seth-shi/apple-refund-assistant)
![CodeRabbit Pull Request Reviews](https://img.shields.io/coderabbit/prs/github/seth-shi/apple-refund-assistant?utm_source=oss&utm_medium=github&utm_campaign=seth-shi%2Fapple-refund-assistant&labelColor=171717&color=FF570A&link=https%3A%2F%2Fcoderabbit.ai&label=CodeRabbit+Reviews)

## рд▓рд╛рдЗрд╡ рдбреЗрдореЛ

ЁЯМР **рдбреЗрдореЛ рд╕рд╛рдЗрдЯ**: [https://apple-refund-assistant.shiguopeng.cn/](https://apple-refund-assistant.shiguopeng.cn/)

> тЪая╕П **рдиреЛрдЯ**: рд╕рд┐рд╕реНрдЯрдо рд╣рд░ 30 рдорд┐рдирдЯ рдореЗрдВ рд░реАрд╕реЗрдЯ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

## рдЕрд╡рд▓реЛрдХрди

Apple рдХреЗ CONSUMPTION_REQUEST рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдХреЛ рд░реАрдпрд▓-рдЯрд╛рдЗрдо рдореЗрдВ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░реЗрдВ рдФрд░ рддреБрд░рдВрдд Apple рдХреЛ рдЙрдкрднреЛрдЧ рдЬрд╛рдирдХрд╛рд░реА рд╡рд╛рдкрд╕ рднреЗрдЬреЗрдВ, рдзреЛрдЦрд╛рдзрдбрд╝реА рд╡рд╛рд▓реЗ рд░рд┐рдлрдВрдб рдХреЛ рдХрдо рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдВред


- **рдорд▓реНрдЯреА-рдХрд░реЗрдВрд╕реА рд╕рдкреЛрд░реНрдЯ**
- **рдорд▓реНрдЯреА-рдЯреЗрдиреЗрдВрдЯ рд╕рдкреЛрд░реНрдЯ**
- **рдорд▓реНрдЯреА-рд▓реИрдВрдЧреНрд╡реЗрдЬ рд╕рдкреЛрд░реНрдЯ (ф╕нцЦЗ / English / Espa├▒ol / рд╣рд┐рдиреНрджреА / ╪з┘Д╪╣╪▒╪и┘К╪й / Portugu├кs / ╨а╤Г╤Б╤Б╨║╨╕╨╣ / цЧецЬмшкЮ / Fran├зais)**
- **рд╢реВрдиреНрдп рдирд┐рд░реНрднрд░рддрд╛ - рддреЗрдЬрд╝ рддреИрдирд╛рддреА рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдиреАрдп рд╕реЗрд╡рд╛ рд╕реАрдзреЗ рд╢реБрд░реВ рдХрд░реЗрдВ**

| рдирд┐рд░реНрднрд░рддрд╛ | рд╢реВрдиреНрдп рдирд┐рд░реНрднрд░рддрд╛ |  рдЙрдиреНрдирдд   |
|-----|--|-----|
|  рдбреЗрдЯрд╛рдмреЗрд╕   | sqlite | MySQL |
|  рдХреИрд╢   | file | redis  |
|   рд╕рддреНрд░ | file |  redis   |
- **Webhook** API **100%** рдЯреЗрд╕реНрдЯ рдХрд╡рд░реЗрдЬ рдХреЗ рд╕рд╛рде
- **рд╕реНрд╡-рдкреНрд░рдмрдВрдзрд┐рдд рдХреБрдВрдЬреА** - рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреЗрд╡рд▓ рдЖрдкрдХреЗ рдбреЗрдЯрд╛рдмреЗрд╕ `apps` рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ (рд╕рдордорд┐рдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд╕рд╛рде, рдЖрдкрдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдХреБрдВрдЬреА)
- **12 рдЙрдкрднреЛрдЧ рдлреАрд▓реНрдб** - рд╕рднреА рдЖрд╡рд╢реНрдпрдХ Apple рдлреАрд▓реНрдб рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ
- рд╕рд░реНрд╡рд░ рд╕рдВрджреЗрд╢ рдлреЙрд░рд╡рд░реНрдбрд┐рдВрдЧ рд╕рдкреЛрд░реНрдЯ
  - Apple рд╕рд░реНрд╡рд░ рд╡рд░реНрддрдорд╛рди рд╕реЗрд╡рд╛ рдХреЛ рднреЗрдЬрддрд╛ рд╣реИ, рдЬреЛ рдЖрдкрдХреЗ рдЙрддреНрдкрд╛рджрди рд╕рд░реНрд╡рд░ рдХреЛ рдлреЙрд░рд╡рд░реНрдб рдХрд░рддрд╛ рд╣реИ

 
## рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ
![рд╣реЛрдордкреЗрдЬ](assets/0.png)
![рд╣реЛрдордкреЗрдЬ](assets/1.png)
![рд╣реЛрдордкреЗрдЬ](assets/2.png)
![рд╣реЛрдордкреЗрдЬ](assets/3.png)
![рд╣реЛрдордкреЗрдЬ](assets/4.png)
![рд╣реЛрдордкреЗрдЬ](assets/5.png)


## рддреНрд╡рд░рд┐рдд рд╢реБрд░реБрдЖрдд
### рдкреВрд░реНрд╡-рдирд┐рд░реНрдорд┐рдд рдЗрдореЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛
```bash
docker run -d \
  -p 8080:8080 \
  --name apple-refund-assistant \
  --restart=always \
  ghcr.io/seth-shi/apple-refund-assistant:latest
```


### рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдмрдирд╛рдПрдВ рдФрд░ рдЪрд▓рд╛рдПрдВ
```bash
git clone https://github.com/seth-shi/apple-refund-assistant
cd apple-refund-assistant
## рдЗрдореЗрдЬ рдмрдирд╛рдПрдВ рдФрд░ рддреИрдирд╛рдд рдХрд░реЗрдВ
./deploy.sh
```

### рдпрджрд┐ рдЖрдкрдХреЛ рдбреЗрдЯрд╛ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ
```
touch database.sqlite
docker run -d \
  -p 8080:8080 \
  -v $(pwd)/database.sqlite:/var/www/html/database/database.sqlite \
  --name apple-refund-assistant \
  --restart=always \
  ghcr.io/seth-shi/apple-refund-assistant:latest
```

## рдЙрдкрднреЛрдЧ рдлреАрд▓реНрдб рд░рдгрдиреАрддрд┐
* рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг: [https://developer.apple.com/documentation/appstoreserverapi/consumptionrequest](https://developer.apple.com/documentation/appstoreserverapi/consumptionrequest)
* рд░рдгрдиреАрддрд┐ рдХреЛрдб: [ConsumptionService.php](./app/Services/ConsumptionService.php) 
* `users` рддрд╛рд▓рд┐рдХрд╛ рдлреАрд▓реНрдб рдЕрдиреНрдп рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдЕрдкрдбреЗрдЯ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ

| рдлреАрд▓реНрдб                       | рд╡рд┐рд╡рд░рдг                | рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд                          | рдЧрдгрдирд╛ рдирд┐рдпрдо                                                                                           |
|--------------------------|-------------------|--------------------------------|------------------------------------------------------------------------------------------------|
| accountTenure            | рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрдВрдЬреАрдХрд░рдг рдХреЗ рдмрд╛рдж рд╕реЗ рджрд┐рди            | `users.register_at`            | рд╡рд░реНрддрдорд╛рди рд╕рдордп рдорд╛рдЗрдирд╕ рдкрдВрдЬреАрдХрд░рдг рд╕рдордп                                                                                     |
| appAccountToken          | рдЦрд╛рддрд╛ рдЯреЛрдХрди          | `users.app_account_token`      | [рдХреНрд▓рд╛рдЗрдВрдЯ рдСрд░реНрдбрд░ рдмрдирд╛рддреЗ рд╕рдордп рдкрд╛рд╕ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП](https://developer.apple.com/documentation/StoreKit/Transaction/appAccountToken) |
| consumptionStatus        | рдЙрдкрднреЛрдЧ рд╕реНрдерд┐рддрд┐              | `transactions.expiration_date` | рд╡рд░реНрддрдорд╛рди рд╕рдордп рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░реЗрдВ, рдпрджрд┐ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рддреЛ рдЙрдкрднреЛрдЧ рдХрд┐рдпрд╛ рд╣реБрдЖ рд░рд┐рдЯрд░реНрди рдХрд░реЗрдВ                                                                              |
| customerConsented        | рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗ рдбреЗрдЯрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╣рдорддрд┐ рджреА          | N/A                              | рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб `true`                                                                                       |
| deliveryStatus           | рдХреНрдпрд╛ рдПрдХ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдЗрди-рдРрдк рдЦрд░реАрдж рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдбрд┐рд▓реАрд╡рд░ рдХреА рдЧрдИ рдереА | N/A                              | рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб `0` (рд╕рд╛рдорд╛рдиреНрдп рдбрд┐рд▓реАрд╡рд░реА)                                                                                    |
| lifetimeDollarsPurchased | рдХреБрд▓ рдЗрди-рдРрдк рдЦрд░реАрдж рд░рд╛рд╢рд┐             | `users.purchased_dollars`      | Apple рд▓реЗрдирджреЗрди рдЗрд╡реЗрдВрдЯ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕рдВрдЪрд┐рдд, рдпрд╛ рдЖрдк рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╕рдВрдЪрдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ                                                                        |
| lifetimeDollarsRefunded  | рдХреБрд▓ рд░рд┐рдлрдВрдб рд░рд╛рд╢рд┐             | `users.refunded_dollars`       | Apple рд░рд┐рдлрдВрдб рдЗрд╡реЗрдВрдЯ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕рдВрдЪрд┐рдд, рдпрд╛ рдЖрдк рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╕рдВрдЪрдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ                                                                        |
| platform                 | рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо                | N/A                              | рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб `1` (apple)                                                                                   |
| playTime                 | рдЧреНрд░рд╛рд╣рдХ рдРрдк рдЙрдкрдпреЛрдЧ рд╕рдордп рдореВрд▓реНрдп        | `users.play_seconds`           | рдЖрдкрдХреЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдЗрд╕ рдлреАрд▓реНрдб рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЕрдиреНрдпрдерд╛ рдпрд╣ `0` рд╣реИ                                                                          |
| refundPreference         | рд░рд┐рдлрдВрдб рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП рдЕрдкреЗрдХреНрд╖рд┐рдд рдкрд░рд┐рдгрд╛рдо         | `transactions.expiration_date` | рд╡рд░реНрддрдорд╛рди рд╕рдордп рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░реЗрдВ, рдпрджрд┐ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рддреЛ рд░рд┐рдлрдВрдб рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рдкрд╕рдВрдж рдХрд░реЗрдВ                                                                             |
| sampleContentProvided    | рдХреНрдпрд╛ рдЯреНрд░рд╛рдпрд▓ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ            | `apps.sample_content_provided` | рдРрдк рдмрдирд╛рддреЗ рд╕рдордп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ                                                                                      |
| userStatus               | рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд┐рддрд┐              | N/A                              | рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб `1` (рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛)                                                                                   |



## рд▓рд╛рдЗрд╕реЗрдВрд╕

Apache License 2.0 рдХреЗ рддрд╣рдд рд▓рд╛рдЗрд╕реЗрдВрд╕ рдкреНрд░рд╛рдкреНрдд, рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП [LICENSE](./LICENSE) рджреЗрдЦреЗрдВред

## рд╕рд╣рд╛рдпрддрд╛

рдкреНрд░рд╢реНрдиреЛрдВ рдпрд╛ рдЪрд┐рдВрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рдХреГрдкрдпрд╛ GitHub рдкрд░ рдПрдХ issue рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

## рднрд╡рд┐рд╖реНрдп рдХреА рдпреЛрдЬрдирд╛рдПрдВ
- рдЕрдиреНрдп рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ рдпрд╛ рд╕рд╣рдпреЛрдЧ рдореЗрдВ рд░реБрдЪрд┐ рд╣реИ? рдХреГрдкрдпрд╛ GitHub рдкрд░ рдПрдХ issue рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ - рд╣рдо рдЖрдкрдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ!

## рдЖрднрд╛рд░
* [Rates By Exchange Rate API](https://www.exchangerate-api.com)

